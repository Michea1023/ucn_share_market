{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gasri\\\\Documents\\\\ucn_share_market\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n    _s = $RefreshSig$();\n\nimport React, { createContext, useState, useEffect } from \"react\";\nimport jwt_decode from \"jwt-decode\";\nimport { useHistory } from \"react-router-dom\";\nimport { getRequest } from \"./Request\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction getCookie(name) {\n  let cookieValue = null;\n\n  if (document.cookie && document.cookie !== '') {\n    const cookies = document.cookie.split(';');\n\n    for (let i = 0; i < cookies.length; i++) {\n      const cookie = cookies[i].trim(); // 多Esta cadena de cookies comienza con el nombre que queremos?\n\n      if (cookie.substring(0, name.length + 1) === name + '=') {\n        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n        break;\n      }\n    }\n  }\n\n  return cookieValue;\n}\n\nconst AuthContext = /*#__PURE__*/createContext();\nexport default AuthContext;\nexport const AuthProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState(() => localStorage.getItem(\"authTokens\") ? jwt_decode(localStorage.getItem(\"authTokens\")) : null);\n  const [loading, setLoading] = useState(false);\n  const history = useHistory();\n\n  const loginUser = async (rut, password) => {\n    const response = await fetch(\"http://127.0.0.1:8000/api/login\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-CSRFToken\": getCookie(\"csrftoken\")\n      },\n      body: JSON.stringify({\n        rut,\n        password\n      })\n    });\n    const data = await response.json();\n\n    if (response.status === 200) {\n      setUser(data);\n      sessionStorage.setItem(\"user\", JSON.stringify(data));\n      data.staff ? history.push(\"/admin\") : history.push(\"/home\") // condicion (x === 1) ? (codigo verdadero) : (codigo en el caso contrario) operadores ternario\n      ;\n    } else if (response.status == 404) {\n      alert(\"Usuario no encontrado o contrase単a incorrecta\");\n    } else if (response.status == 406) {\n      alert(\"Usuario bloqueado, contacta con el administrador\");\n    } else {\n      alert(\"Problema desconocido, http: \" + response.status);\n    }\n  };\n\n  const registerUser = async (rut, password, password2, email, full_name, career) => {\n    const data = {\n      rut,\n      password,\n      password2,\n      email,\n      full_name,\n      career\n    };\n    console.log(JSON.stringify(data));\n    const response = await fetch(\"http://127.0.0.1:8000/api/create-user\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"X-CSRFToken\": getCookie(\"csrftoken\")\n      },\n      body: JSON.stringify(data)\n    });\n\n    if (response.status == 201) {\n      alert(\"Usuario creado con exito\");\n      history.push(\"/\");\n    } else {\n      alert(\"Error desconocido (rut o correo ya existente)\");\n    }\n  };\n\n  const logOut = () => {\n    setUser(null);\n    sessionStorage.clear();\n    getRequest(\"http://127.0.0.1:8000/api/logout\");\n    history.push(\"/\");\n  };\n\n  useEffect(() => {\n    if (setUser) {\n      setUser(user);\n    }\n\n    setLoading(false);\n  }, [setUser, loading]);\n  const contextData = {\n    user,\n    setUser,\n    registerUser,\n    loginUser,\n    logOut\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: loading ? null : children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 129,\n    columnNumber: 9\n  }, this);\n};\n\n_s(AuthProvider, \"sLp7ZhE5Xkc54NbbB5Wz13u0rjM=\", false, function () {\n  return [useHistory];\n});\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","jwt_decode","useHistory","getRequest","getCookie","name","cookieValue","document","cookie","cookies","split","i","length","trim","substring","decodeURIComponent","AuthContext","AuthProvider","children","user","setUser","localStorage","getItem","loading","setLoading","history","loginUser","rut","password","response","fetch","method","headers","body","JSON","stringify","data","json","status","sessionStorage","setItem","staff","push","alert","registerUser","password2","email","full_name","career","console","log","logOut","clear","contextData"],"sources":["C:/Users/gasri/Documents/ucn_share_market/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from \"react\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport {getRequest} from \"./Request\";\r\n\r\n\r\nfunction getCookie(name) {\r\n    let cookieValue = null;\r\n    if (document.cookie && document.cookie !== '') {\r\n        const cookies = document.cookie.split(';');\r\n        for (let i = 0; i < cookies.length; i++) {\r\n            const cookie = cookies[i].trim();\r\n            // 多Esta cadena de cookies comienza con el nombre que queremos?\r\n            if (cookie.substring(0, name.length + 1) === (name + '=')) {\r\n                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    return cookieValue;\r\n}\r\n\r\n\r\n\r\n\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport default AuthContext;\r\n\r\nexport const AuthProvider = ({children}) => {\r\n\r\n      const [user, setUser] = useState(() =>\r\n        localStorage.getItem(\"authTokens\")\r\n          ? jwt_decode(localStorage.getItem(\"authTokens\"))\r\n          : null\r\n      );\r\n\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const history = useHistory();\r\n\r\n    const loginUser = async (rut, password) => {\r\n        const response = await fetch(\"http://127.0.0.1:8000/api/login\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n              \"X-CSRFToken\": getCookie(\"csrftoken\")\r\n\r\n          },\r\n          body: JSON.stringify({\r\n            rut,\r\n            password\r\n          })\r\n        });\r\n        const data = await response.json();\r\n        if (response.status === 200) {\r\n          setUser(data);\r\n          sessionStorage.setItem(\"user\",JSON.stringify(data));\r\n          data.staff ? history.push(\"/admin\") : history.push(\"/home\")   // condicion (x === 1) ? (codigo verdadero) : (codigo en el caso contrario) operadores ternario\r\n          ;\r\n        }else if(response.status == 404){\r\n                alert(\"Usuario no encontrado o contrase単a incorrecta\")\r\n        }else if(response.status == 406){\r\n                alert(\"Usuario bloqueado, contacta con el administrador\")\r\n        }else{\r\n            alert(\"Problema desconocido, http: \" + response.status)\r\n        }\r\n\r\n  };\r\n\r\n    const registerUser = async (rut, password, password2, email, full_name, career) => {\r\n        const data = {\r\n            rut,\r\n            password,\r\n            password2,\r\n            email,\r\n            full_name,\r\n            career\r\n        }\r\n\r\n        console.log(JSON.stringify(data))\r\n\r\n        const response = await fetch(\"http://127.0.0.1:8000/api/create-user\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                 \"X-CSRFToken\": getCookie(\"csrftoken\")\r\n            },\r\n            body: JSON.stringify(data)\r\n        })\r\n\r\n\r\n        if(response.status==201){\r\n            alert(\"Usuario creado con exito\")\r\n            history.push(\"/\");\r\n        }else{\r\n            alert(\"Error desconocido (rut o correo ya existente)\")\r\n        }\r\n\r\n\r\n\r\n    };\r\n\r\n    const logOut = () => {\r\n        setUser(null);\r\n        sessionStorage.clear()\r\n        getRequest(\"http://127.0.0.1:8000/api/logout\")\r\n        history.push(\"/\");\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (setUser) {\r\n          setUser(user);\r\n        }\r\n        setLoading(false);\r\n    }, [setUser, loading]);\r\n\r\n    const contextData = {\r\n        user,\r\n        setUser,\r\n        registerUser,\r\n        loginUser,\r\n        logOut\r\n\r\n  };\r\n\r\n    return (\r\n        <AuthContext.Provider value={contextData}>\r\n          {loading ? null : children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\n\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}